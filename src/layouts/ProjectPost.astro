---
import type { MarkdownHeading } from 'astro'
import type { CollectionEntry } from 'astro:content'

// Blog í¬ìŠ¤íŠ¸ê°€ ì“°ë˜ UIë“¤ ì¬ì‚¬ìš©
import 'katex/dist/katex.min.css'

import { MediumZoom } from 'astro-pure/advanced'
import { ArticleBottom, Hero, TOC } from 'astro-pure/components/pages'
import Copyright from '@/components/Copyright.astro'
import PageLayout from '@/layouts/ContentLayout.astro'
import { integ } from '@/site-config'
import Giscus from '@/components/Giscus.astro'


interface Props {
  project: CollectionEntry<'projects'>
  projects?: CollectionEntry<'projects'>[]   // ì¶”ì²œ/í•˜ë‹¨ ëª©ë¡ì— ì“¸ ìˆ˜ ìˆìŒ(ì„ íƒ)
  headings: MarkdownHeading[]
  remarkPluginFrontmatter: Record<string, unknown>
}

const { project, projects = [], headings, remarkPluginFrontmatter } = Astro.props

// ë‹¨ì¼ ê¸€ì„ ë¸”ë¡œê·¸ í¬ë§·ìœ¼ë¡œ ë§¤í•‘
const blogLike: any = {
  ...project,
  collection: 'blog', // ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸ê°€ collection ì²´í¬í•˜ëŠ” ê²½ìš° ëŒ€ë¹„
  data: {
    title: project.data.title,
    description: project.data.description ?? '',
    publishDate: project.data.pubDate,            // pubDate â†’ publishDate
    updatedDate: (project.data as any).updatedDate,
    tags: project.data.tags ?? [],
    heroImage: project.data.heroImage,
    draft: project.data.draft ?? false,           // ê¸°ë³¸ê°’
    // í”„ë¡œì íŠ¸ëŠ” ê¸°ë³¸ ì¼¬. ê°œë³„ ê¸€ì—ì„œ comment:falseë¡œ ëŒ ìˆ˜ ìˆìŒ
    comment: (project.data as any).comment ?? true,
    locale: project.data.locale,
    slug: project.data.slug
  }
}

const data = blogLike.data
const socialImage = data.heroImage
  ? (typeof data.heroImage.src === 'string' ? data.heroImage.src : data.heroImage.src.src)
  : '/images/social-card.png'
const articleDate = data.updatedDate?.toISOString() ?? data.publishDate.toISOString()
const primaryColor = data.heroImage?.color ?? 'hsl(var(--primary) / var(--un-text-opacity))'
---

<PageLayout
  meta={{ articleDate, description: data.description, ogImage: socialImage, title: data.title }}
  highlightColor={primaryColor}
  back='/projects'
>
  {!!headings.length && <TOC {headings} slot='sidebar' />}

  <Hero data={data} {remarkPluginFrontmatter} slot='header'>
    <Fragment slot='description'>
      {!data.draft && data.comment && <span class="mt-1 text-sm text-muted-foreground">ëŒ“ê¸€ì„ í™˜ì˜í•´ìš” ğŸ™Œ</span>}
    </Fragment>
  </Hero>

  <slot />

  <Fragment slot='bottom'>
    <Copyright data={data} />
    {/* ì¶”ì²œ ì„¹ì…˜: projectsë¥¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë§¤í•‘í•´ ë„˜ê¸°ë©´ ì‚¬ìš© ê°€ëŠ¥. ê°„ë‹¨íˆ ìƒëµí•´ë„ ë¨ */}
    <ArticleBottom collections={projects} id={project.id} class='mt-3 sm:mt-6' />
    {!data.draft && data.comment && <Giscus />}
  </Fragment>

  <slot name='bottom-sidebar' slot='bottom-sidebar' />
</PageLayout>

{integ.mediumZoom.enable && <MediumZoom />}
